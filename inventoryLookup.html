<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>재고조회 - 통합 재고관리 시스템</title>
    <link rel="stylesheet" href="styles-v2.css">
    <script src="https://kit.fontawesome.com/a2309d579f.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <aside class="sidebar" id="sidebar"></aside>
        <main class="main-content">
            <header>
                <h1>재고 조회</h1>
            </header>

            <div class="search-container card">
                <form id="searchForm">
                    <div class="form-group">
                        <label for="itemQuery">품목코드 또는 품명으로 검색:</label>
                        <input type="text" id="itemQuery" name="itemQuery" placeholder="검색어 입력...">
                    </div>
                    <button type="submit" class="btn btn-primary">검색</button>
                </form>
            </div>

            <div class="table-container card">
                 <table id="inventoryTable">
                    <thead>
                        <tr>
                            <th>품목코드</th>
                            <th>품명</th>
                            <th>규격</th>
                            <th>현재고</th>
                            <th>안전재고</th>
                            <th>재고상태</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </main>
    </div>
    <script src="utils-v2.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 네비게이션 로드
            loadNavigation('inventoryLookup');

            const searchForm = document.getElementById('searchForm');
            const itemQueryInput = document.getElementById('itemQuery');
            const tableBody = document.querySelector('#inventoryTable tbody');

            // 재고 조회 함수
            function fetchInventory(query = '') {
                showLoading('inventoryTable');
                const url = `/.netlify/functions/getInventoryData?query=${encodeURIComponent(query)}`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        tableBody.innerHTML = '';
                        if (data.length === 0) {
                            showMessage('inventoryTable', '검색 결과가 없습니다.');
                            return;
                        }

                        data.forEach(item => {
                            const fields = item.fields;
                            const currentStock = fields['현재고'] || 0;
                            const safetyStock = fields['안전재고'] || 0;
                            let status = '<span style="color: green;">● 양호</span>';
                            if (currentStock < safetyStock) {
                                status = '<span style="color: red;">● 부족</span>';
                            } else if (currentStock <= safetyStock * 1.2) {
                                status = '<span style="color: orange;">● 주의</span>';
                            }
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${fields['품목코드'] || ''}</td>
                                <td>${fields['품명'] || ''}</td>
                                <td>${fields['규격'] || ''}</td>
                                <td>${currentStock}</td>
                                <td>${safetyStock}</td>
                                <td>${status}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showMessage('inventoryTable', '데이터를 불러오는 중 오류가 발생했습니다.');
                    });
            }

            // 초기 데이터 로드
            fetchInventory();

            // 검색 폼 제출 이벤트
            searchForm.addEventListener('submit', function (event) {
                event.preventDefault();
                fetchInventory(itemQueryInput.value.trim());
            });
        });
    </script>
</body>
</html>
