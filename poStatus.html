<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>발주현황 - 통합 재고관리 시스템</title>
    <link rel="stylesheet" href="/styles-v2.css">
    <script src="https://kit.fontawesome.com/a2309d579f.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <aside class="sidebar" id="sidebar"></aside>
        <main class="main-content">
            <header>
                <h1>발주현황 조회</h1>
            </header>
            
            <div class="search-container card">
                <form id="searchForm" class="form-group">
                    <label for="poNumber">발주번호로 검색:</label>
                    <input type="text" id="poNumber" name="poNumber" placeholder="발주번호 입력">
                    <button type="submit" class="btn btn-primary">검색</button>
                </form>
            </div>

            <div class="table-container card">
                <table id="poTable">
                    <thead>
                        <tr>
                            <th>발주번호</th>
                            <th>품목코드</th>
                            <th>품명</th>
                            <th>수량</th>
                            <th>단위</th>
                            <th>입고예정일</th>
                            <th>상태</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </main>
    </div>
    <script src="/utils-v2.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            loadNavigation('poStatus');

            const searchForm = document.getElementById('searchForm');
            const poNumberInput = document.getElementById('poNumber');
            const tableBody = document.querySelector('#poTable tbody');

            function fetchPoStatus(poNumber = '') {
                showLoading('poTable');
                let url = '/.netlify/functions/getPoStatusDetails';
                if (poNumber) {
                    url += `?poNumber=${encodeURIComponent(poNumber)}`;
                }

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        tableBody.innerHTML = '';
                        if (data.length === 0) {
                            showMessage('poTable', '해당하는 발주 데이터가 없습니다.');
                            return;
                        }
                        data.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${item.fields['발주번호'] || ''}</td>
                                <td>${item.fields['품목코드'] || ''}</td>
                                <td>${item.fields['품명'] || ''}</td>
                                <td>${item.fields['수량'] || ''}</td>
                                <td>${item.fields['단위'] || ''}</td>
                                <td>${item.fields['입고예정일'] || ''}</td>
                                <td>${item.fields['상태'] || ''}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showMessage('poTable', '데이터를 불러오는 중 오류가 발생했습니다.');
                    });
            }

            fetchPoStatus();

            searchForm.addEventListener('submit', function (event) {
                event.preventDefault();
                fetchPoStatus(poNumberInput.value.trim());
            });
        });
    </script>
</body>
</html>
