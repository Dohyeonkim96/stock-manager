<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>통합 재고관리 시스템</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
  <style>
    :root {
      --primary-color: #0d6efd; --secondary-color: #6c757d; --accent-color: #e9ecef;
      --success-color: #198754; --info-color: #0dcaf0; --warning-color: #ffc107; --danger-color: #dc3545;
      --text-color-primary: #212529; --text-color-secondary: #495057; --label-color: #6c757d;
      --page-bg: #f8f9fa; --card-bg: #ffffff; --input-bg-editable: #fff; --input-bg-readonly: #e9ecef;
      --border-color: #dee2e6; --border-radius-sm: 0.25rem; --border-radius-md: 0.375rem;
      --spacing-xs: 4px; --spacing-sm: 8px; --spacing-md: 16px; --spacing-lg: 24px; --spacing-xl: 32px;
      --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-size-base: 1rem; --font-size-sm: 0.875rem; --font-size-label: 0.85rem; --font-size-input: 1rem;
      --font-size-title-main: 1.5rem; --font-size-title-section: 1.25rem;
      --box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; font-family: var(--font-family-base); font-size: var(--font-size-base); color: var(--text-color-primary); background-color: var(--page-bg); }
    .section-card { background-color: var(--card-bg); padding: var(--spacing-lg); border-radius: var(--border-radius-md); box-shadow: var(--box-shadow); border: 1px solid var(--border-color); }
    .page-main-title { font-size: var(--font-size-title-main); margin: 0 0 var(--spacing-lg) 0; color: var(--primary-color); }
    .section-title { font-size: var(--font-size-title-section); margin: 0 0 var(--spacing-md) 0; padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--primary-color); }
    .button, button { display: inline-flex; align-items: center; justify-content: center; padding: 10px 16px; font-size: var(--font-size-base); font-weight: 500; border: 1px solid transparent; border-radius: var(--border-radius-sm); cursor: pointer; transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; line-height: 1.5; white-space: nowrap; }
    .button-primary { color: #fff; background-color: var(--primary-color); border-color: var(--primary-color); }
    .button-primary:hover { background-color: #0b5ed7; }
    .button-secondary { color: #fff; background-color: var(--secondary-color); border-color: var(--secondary-color); }
    .button-secondary:hover { background-color: #5c636a; }
    .button-danger { color: #fff; background-color: var(--danger-color); border-color: var(--danger-color); }
    .button-danger:hover { background-color: #bb2d3b; }
    .form-group { margin-bottom: var(--spacing-md); display: flex; flex-direction: column; }
    .form-group label { margin-bottom: var(--spacing-sm); font-size: var(--font-size-label); font-weight: 500; color: var(--label-color); }
    input[type="text"], input[type="number"], input[type="date"], select { padding: var(--spacing-sm) var(--spacing-md); font-size: var(--font-size-input); line-height: 1.5; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; height: calc(var(--font-size-input) + 22px); }
    input.editable, select.editable { background-color: var(--input-bg-editable); }
    input:read-only, input[readonly] { background-color: var(--input-bg-readonly); cursor: not-allowed; }
    input:focus, select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); }
    .message { padding: var(--spacing-md); margin-bottom: var(--spacing-md); border-radius: var(--border-radius-sm); border: 1px solid transparent; display: none; }
    .message.success { color: #0f5132; background-color: #d1e7dd; border-color: #badbcc; display: block; }
    .message.error { color: #842029; background-color: #f8d7da; border-color: #f5c2c7; display: block; }
    .message.info { color: #055160; background-color: #cff4fc; border-color: #b6effb; display: block; }
    .loading-spinner { display: none; width: 1em; height: 1em; border: 2px solid currentColor; border-right-color: transparent; border-radius: 50%; animation: spinner-border .75s linear infinite; vertical-align: text-bottom; margin-left: var(--spacing-sm); }
    @keyframes spinner-border { to { transform: rotate(360deg); } }
  </style>

  <style>
    /* 메인 레이아웃 스타일 */
    html, body { height: 100vh; overflow: hidden; }
    body { display: flex; flex-direction: column; }
    .gnb { flex-shrink: 0; display: flex; align-items: center; padding: 0 var(--spacing-lg); background-color: var(--primary-color); color: white; height: 55px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 1001; }
    .gnb-title { font-size: 1.25rem; font-weight: bold; }
    .gnb-menu { margin-left: auto; display: flex; gap: var(--spacing-md); }
    .gnb-menu a { color: white; text-decoration: none; font-weight: 500; padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--border-radius-sm); transition: background-color 0.2s; font-size: 1rem; }
    .gnb-menu a:hover, .gnb-menu a.active { background-color: rgba(255,255,255,0.15); }
    .app-body { display: flex; flex-grow: 1; overflow: hidden; }
    .lnb { flex-shrink: 0; width: 230px; background-color: var(--card-bg); border-right: 1px solid var(--border-color); padding: var(--spacing-lg); overflow-y: auto; transition: width 0.3s ease-in-out; }
    .lnb-title { font-size: 1.1rem; font-weight: bold; color: var(--primary-color); margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--border-color);}
    .lnb ul { list-style: none; padding: 0; margin: 0; }
    .lnb li a { display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-sm) var(--spacing-md); text-decoration: none; color: var(--text-color-secondary); border-radius: var(--border-radius-sm); font-weight: 500; font-size: 0.95rem; transition: background-color 0.2s, color 0.2s; }
    .lnb li a i { width: 18px; text-align: center; color: #90a4ae; }
    .lnb li a:hover { background-color: var(--page-bg); color: var(--text-color-primary); }
    .lnb li a.active { background-color: var(--accent-color); color: var(--primary-color); font-weight: bold; }
    .lnb li a.active i { color: var(--primary-color); }
    .content-wrapper { flex-grow: 1; overflow-y: auto; padding: var(--spacing-lg); position: relative; }
    #global-message-area { position: fixed; top: 65px; left: 50%; transform: translateX(-50%); z-index: 2000; width: auto; min-width: 300px; max-width: 80%; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    #content-area.loading { opacity: 0.3; pointer-events: none; }
    .mobile-menu-toggle { display: none; }
    @media (max-width: 768px) {
        .app-body { position: relative; }
        .lnb { position: absolute; left: 0; top: 0; bottom: 0; z-index: 1000; box-shadow: 2px 0 5px rgba(0,0,0,0.2); transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
        .lnb.open { transform: translateX(0); }
        .mobile-menu-toggle { display: block; color: white; font-size: 1.2rem; margin-right: var(--spacing-md); background: none; border: none; cursor: pointer; }
        .gnb-title { margin-left: auto; }
        .gnb-menu { display: none; } 
        .backdrop { display: none; position: absolute; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.3); z-index: 999;}
        .backdrop.visible { display: block; }
    }
  </style>
</head>
<body>
  <header class="gnb">
    <button class="mobile-menu-toggle" onclick="toggleLnb()"><i class="fas fa-bars"></i></button>
    <div class="gnb-title">통합 관리 시스템</div>
    <nav class="gnb-menu">
      <a href="#orderMgmt" data-app="orderMgmt" class="gnb-link active" onclick="handleGnbClick(event)">발주/재고 관리</a>
      <a href="#shippingSummary" data-app="shippingSummary" class="gnb-link" onclick="handleGnbClick(event)">출고 요약</a>
    </nav>
  </header>
  <div class="app-body">
    <nav class="lnb" id="lnb"></nav>
    <main class="content-wrapper">
      <div id="global-message-area" class="message"></div>
      <div id="content-area"></div>
    </main>
    <div class="backdrop" id="backdrop" onclick="toggleLnb()"></div>
  </div>
  
  <script>
    function showMessage(text, type, timeout = 4000) {
      const messageArea = document.getElementById('global-message-area');
      if (!messageArea) {
        console.error("Global message area not found.");
        alert(text);
        return;
      }
      messageArea.textContent = text;
      messageArea.className = 'message ' + type;
      messageArea.style.display = 'block';

      if (messageArea.timerId) clearTimeout(messageArea.timerId);
      
      messageArea.timerId = setTimeout(() => {
        messageArea.style.display = 'none';
      }, timeout);
    }

    function formatNumberWithCommas(number) {
      const num = Number(String(number).replace(/,/g, ''));
      if (number === null || number === undefined || String(number).trim() === "" || isNaN(num)) {
        return "";
      }
      return num.toLocaleString('ko-KR');
    }
  </script>

  <script>
    const lnbMenus = {
      orderMgmt: {
        title: '발주/재고 관리',
        items: [
          { page: 'index', text: '발주서 생성/현황', icon: 'fa-file-invoice' },
          { page: 'poStatus', text: 'PO 잔량 조회', icon: 'fa-file-circle-question' },
          { page: 'stockReceiving', text: '입고 등록', icon: 'fa-dolly' },
          { page: 'inventoryLookup', text: '재고 현황 조회', icon: 'fa-boxes-stacked' },
          { page: 'productionPlan', text: '생산 계획 관리', icon: 'fa-calendar-days' },
          { page: 'shippingRequest', text: '출고 요청', icon: 'fa-truck-fast' },
          { page: 'shippingConfirmation', text: '출고 요청 확인', icon: 'fa-clipboard-check' },
          { page: 'deliveryHistory', text: '납품 이력 조회', icon: 'fa-history' }
        ]
      },
      shippingSummary: {
        title: '출고 요약',
        items: [
          { page: 'shippingSummary', text: '월별 수량 조회', icon: 'fa-chart-bar' }
        ]
      }
    };
    
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const initialApp = urlParams.get('app') || 'orderMgmt';
      const initialPage = urlParams.get('page') || 'index';
      
      updateLnb(initialApp);
      navigateTo(initialApp, initialPage, false); 
      
      window.onpopstate = e => {
        if (e.state) {
          navigateTo(e.state.app, e.state.page, false);
        }
      };
    });
    
    function handleGnbClick(e) {
      e.preventDefault();
      const app = e.target.dataset.app;
      const firstPage = lnbMenus[app].items[0].page;
      updateLnb(app);
      navigateTo(app, firstPage, true);
    }
    
    function handleLnbClick(e) {
      e.preventDefault();
      navigateTo(e.currentTarget.dataset.app, e.currentTarget.dataset.page, true);
      if (window.innerWidth <= 768) {
        toggleLnb();
      }
    }
    
    function navigateTo(app, page, pushState) {
      const url = `?app=${app}&page=${page}`;
      if (window.location.search !== url) {
        const state = { app, page };
        if (pushState) {
          history.pushState(state, '', url);
        } else {
          history.replaceState(state, '', url);
        }
      }
      updateActiveLinks(app, page);
      loadPageContent(page);
    }
    
    function updateLnb(app) {
      const lnb = document.getElementById('lnb');
      const menuData = lnbMenus[app];
      if (!menuData) { lnb.innerHTML = ''; return; }
      let html = `<h2 class="lnb-title">${menuData.title}</h2><ul>`;
      menuData.items.forEach(item => {
        html += `<li><a href="#" class="lnb-link" data-app="${app}" data-page="${item.page}" onclick="handleLnbClick(event)"><i class="fas ${item.icon}"></i><span>${item.text}</span></a></li>`;
      });
      lnb.innerHTML = html + `</ul>`;
    }
    
    function updateActiveLinks(app, page) {
      document.querySelectorAll('.gnb-link').forEach(l => l.classList.toggle('active', l.dataset.app === app));
      document.querySelectorAll('.lnb-link').forEach(l => l.classList.toggle('active', l.dataset.page === page));
    }
    
    function toggleLnb() {
      document.getElementById('lnb').classList.toggle('open');
      document.getElementById('backdrop').classList.toggle('visible');
    }
    
    async function loadPageContent(page) {
      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = '';
      contentArea.classList.add('loading');
      
      Array.from(document.querySelectorAll('script[data-dynamic-script]')).forEach(oldScript => {
        oldScript.remove();
      });

      try {
        const response = await fetch(`${page}.html`);
        if (!response.ok) {
          throw new Error(`'${page}.html' 페이지를 찾을 수 없습니다.`);
        }
        const html = await response.text();
        contentArea.innerHTML = html;
        
        Array.from(contentArea.querySelectorAll("script")).forEach(script => {
          const newScript = document.createElement("script");
          newScript.setAttribute('data-dynamic-script', 'true');
          newScript.textContent = script.textContent;
          document.body.appendChild(newScript);
        });
      } catch (error) {
        contentArea.innerHTML = `<div class="message error" style="display:block;">페이지 로드 오류: ${error.message}</div>`;
      } finally {
        contentArea.classList.remove('loading');
      }
    }
  </script>
</body>
</html>
